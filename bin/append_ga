#!/usr/bin/env node

const fs = require('fs')
const { JSDOM } = require('jsdom')

const cwd = process.cwd()
const dir = `${cwd}/dist/clocks`
const ga = fs.readFileSync(`${cwd}/src/ga.html`)
const gaScripts = new JSDOM(ga).window.document.querySelectorAll('script')

const insertGA = name => {
  const path = `${dir}/${name}`
  const content = fs.readFileSync(path)
  const dom = new JSDOM(content)
  const head = dom.window.document.querySelector('head')

  gaScripts.forEach(script => head.appendChild(script))

  fs.writeFileSync(path, dom.window.document.documentElement.outerHTML)
}

fs
  .readdirSync(dir)
  .filter(name => name.endsWith('.html'))
  .forEach(insertGA)
